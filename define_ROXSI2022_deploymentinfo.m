%% Create and save structure variable with ADCP deployment information


%%

%
mooringID = ["B02at"; ...    % 600 kHz
             "B04apt"; "B06apt"; "B07ap"; ...    % 1 MHz
             "B08at"; "E03a"; "E04a"; ...
             "E06a"; "E12a"; "X06a"; ...
             "A03a"; "B11a"; "C03ap"; ...    % 2 MHz
             "D01ap"; "D02ap"; ...
             "F01a"; "F02a"; "F03a"; "F04a"; "F05a"; ...
             "X13a"; ...
             "A01a"; ...    % Signature1000
             "B10at"; "B13a"; "B15a"; "B17a"; ...
             "C01a"; "X05at"; "X11a"];

%
instrument = ["Aquadopp600kHz"; ...
              "Aquadopp1MHz"; "Aquadopp1MHz"; "Aquadopp1MHz"; ...
              "Aquadopp1MHz"; "Aquadopp1MHz"; "Aquadopp1MHz"; ...
              "Aquadopp1MHz"; "Aquadopp1MHz"; "Aquadopp1MHz"; ...
              "Aquadopp2MHz"; "Aquadopp2MHz"; "Aquadopp2MHz"; ...
              "Aquadopp2MHz"; "Aquadopp2MHz"; ...
              "Aquadopp2MHz"; "Aquadopp2MHz"; "Aquadopp2MHz"; "Aquadopp2MHz"; "Aquadopp2MHz"; ...
              "Aquadopp2MHz"; ...
              "Signature1000"; "Signature1000"; "Signature1000"; ...
              "Signature1000"; "Signature1000"; "Signature1000"; ...
              "Signature1000"; "Signature1000"];

%
SN = ["12507"; ...    % 600 kHz
      "2147"; "2140"; "2141"; ...    % 1 MHz
      "13288"; "13300"; "13172"; ...
      "9736"; "11150"; "13290"; ...
      "5380"; "12280"; "0709"; ...    % 2 MHz
      "12346"; "0653"; ...
      "9995"; "5838"; "5384"; "5401"; "14032"; ...
      "9945"; ...
      "103043"; ...    % Signature1000
      "103045"; "103046"; "103056"; "101923"; ...
      "102128"; "100231"; "101941"];


%%

% This is partially made up because the exact syncing time
% was not recorded. I could be wrong, but I think the
% Aquadopps were programmed (and clocks were synced) throughout
% the afternoon on Monday, 06/13/2022.
time_set_clockdrift = "2022/06/13 14:00:00";
time_set_clockdrift = repmat(time_set_clockdrift, 21, 1);

% Signature1000: exact clock drift not recorded, but I took times
% taken as the times of Deploy command received from Deployment log
time_set_clockdrift = [time_set_clockdrift; ...
                       "2022/06/14 10:06:43"; ...
                       "2022/06/14 10:13:37"; ...
                       "2022/06/14 09:26:42"; ...
                       "2022/06/14 09:58:33"; ...
                       "2022/06/14 09:34:10"; ...
                       "2022/06/14 09:53:58"; ...
                       "2022/06/14 11:01:05"; ...
                       "2022/06/14 09:48:46"];

% This is the INSTRUMENT time (both Aquadopp and Signature softwares
% provide this information when plugging the instrument to computer)
time_end_clockdrift = ["2022/07/22 11:07:14"; ...    % B02at
                       "2022/07/22 11:23:56"; ...
                       ""; ...
                       "2022/07/25 14:06:06"; ...
                       "2022/07/22 08:37:24"; ...
                       "2022/07/22 08:30:04"; ...
                       "2022/07/22 09:05:01"; ...
                       "2022/07/22 08:39:59"; ...
                       "2022/07/22 08:24:43"; ...
                       "2022/07/22 08:19:49"; ...
                       "2022/07/22 08:36:06"; ...
                       "2022/07/22 09:08:14"; ...
                       "2022/07/25 17:06:36"; ...
                       "2022/07/22 11:11:55"; ...    % D01ap
                       ""; ...
                       "2022/07/22 09:11:44"; ...    % F01a
                       ""; ...
                       "2022/07/22 08:38:29"; ...
                       ""; ...
                       "2022/07/22 08:32:37"; ...    % F05a
                       "2022/07/22 09:18:41"; ...
                       "2022/07/25 08:42:33 "; ...   % Signature1000 / A01a, not exact time
                       "2022/07/25 17:55:52"; ...    % B10at
                       "2022/07/25 17:12:36"; ...    % B13a, not exact time
                       "2022/07/25 14:20:53"; ...    % B15a
                       "2022/07/22 12:45:45"; ...    % B17a not exact time
                       "2022/07/25 14:47:04"; ...    % C01a
                       "2022/07/22 12:57:58"; ...    % X05at, not exact time
                       "2022/07/22 12:45:32"];       % X11a, not exact time


% For the Signatures marked above, the exact time when clock drift
% was obtained was not written down. Instead, I took the time
% from the Deployment *.log files, which is the time recorded after
% stopping the deployment in the Signature software, right after
% the clock drift appears on the screen (so the time I have in
% this file should be less than 1 minute after the true time
% when drift was obtained).

% Clock drift in seconds. The sign is such that adding this
% number to the instrument clock, syncs it to the reference
% clock (i.e. a negative clock drift means that the instrument
% clock is ahead (shows a time after) the reference clock).
clockdrift = [-2.6; ...        % 600 kHz
              9.1; NaN; -11.2; ...        % 1 MHz
              -4.7; -1.4; -1.5; ...
              -4.3; -0.5; 2.9; ...
              -3.1; -0.4; -12.7; ...        % 2 MHz
              -5.0; NaN; ...
              -2.7; NaN; -1.8; NaN; -2.8;...
              -3.0; ...
              62; ...    % Signature1000
              4; 4; 4; -76; ...
              6; 3; 4];

% Time limits to trim the data for when the instrument
% is in the water.
% Start time is the same for all ADCPs (= 2022/06/21 18:00:00).
% All ADCPs but B10at were in the water by the start time. B10at
% was deployed and recovered later than the others (due to weather).
%
% Since, this trimming time is for DRIFT-CORRECTED time, I'll
% make the time_begin_trim earlier than the planned start time
% to make sure no data points are unnecessarily discarded.
%
time_begin_trim = "2022/06/21 17:30:00";
time_begin_trim = repmat(time_begin_trim, 29, 1);
%
% Set start trim time for B10at (which went into the water much
% later than the other ADCPs)
time_begin_trim(strcmp(mooringID, "B10at")) = "2022/06/24 07:40:00";


% Now define time_end_trim picking a time before recovery
time_end_trim = ["2022/07/20 10:50:00"; ...
                 "2022/07/20 07:30:00"; ...    % B04:
                 ""; ...    % B06apt was flooded
                 "2022/07/20 09:58:00"; ...    % B07:
                 "2022/07/21 08:43:00"; ...    % B08: added a few more minutes
                 "2022/07/20 08:58:10"; ...    % E03: pitch/roll show recovery ~40 s before pressure
                 "2022/07/21 08:38:00"; ...
                 "2022/07/20 09:40:00"; ...
                 "2022/07/20 11:04:00"; ...
                 "2022/07/20 11:52:00"; ...
                 "2022/07/20 08:20:00"; ...    % A03
                 "2022/07/21 08:52:00"; ...
                 "2022/07/25 10:27:00"; ...
                 "2022/07/21 07:50:00"; ...
                 "2022/07/21 08:15:00"; ...
                 "2022/07/21 10:39:00"; ...
                 "2022/07/21 09:50:00"; ...
                 "2022/07/21 09:44:00"; ...
                 "2022/07/21 09:37:00"; ...
                 "2022/07/21 10:57:00"; ...
                 "2022/07/20 10:25:00"; ...    % X13a, added more time (~10 min) to avoid swimmers during recovery
                 "2022/07/21 08:36:00"; ...    % Signature1000, A01a
                 "2022/07/25 10:24:00"; ...
                 "2022/07/24 09:20:00"; ...    % B13a, added more time (<=10 min) to avoid swimmers during recovery
                 "2022/07/24 09:35:00"; ...    % B15a, added more time (~10 min) to avoid swimmers during recovery
                 "2022/07/21 09:45:00"; ...    % B17a, added more time (~10 min) to avoid swimmers during recovery
                 "2022/07/20 08:45:00"; ...
                 "2022/07/21 09:20:00"; ...    % X05at weird signal before recovery (maybe divers?) and on air too. removed 15 min before rising to surface
                 "2022/07/20 11:10:00"];       % X11a removing chunk to avoid swimmers during recovery



%% Pressure offset -- this is the number that may be
% set when the ADCP is on air when the ADCP is programmed.
%
% Subtract this offset to compute hydrostatic pressure
% (apart from atmospheric pressure variations relative
% when the pressure offset was set).
%
% The Signature1000 does not have this option (or is the offset always to
% 0??????).
% The Aquadopps have this pressure offset option. Ideally,
% this should be set to 1 (dbar). But in case something else
% was set, than here is where this value can be written and
% properly corrected (3 Aquadopps seem to have a different offset).
%
% Unfortunately, ADCP pressure sensors after recovery do not give
% reliable measurements of the atmospheric pressure (thus, without
% more information, no other corrections can be applied).

%
pressure_offset = [ones(21, 1); ...   % Aquadopps
                   zeros(8, 1)];       % Signatures

% The 3 Aquadopps that seem to have a different offset
% (based on the pressure after recovery) are E12, D01, X13.
% Both D01 and X13 have clear drop of pressure to 0 (dbar)
% after recovery, and then they later diverge to whatever
% values that do not reflect atmospheric pressure (as do
% all ADCPs). Thus, it seems that the pressure offset for
% D01 and X13 were set to 0 when they were programmed.
% E12 drops to 0.28 after recovery. Thus it is unclear
% what was the pressure offset, or whether something went
% wrong with the sensor.

%
l_offset_to_0 = strcmp(mooringID, "D01ap") | strcmp(mooringID, "X13a");

%
pressure_offset(l_offset_to_0) = 0;


%% Create table with deployment information

%
deploymentInfo_ROXSI2022 = ...
                    table(mooringID, instrument, SN, ...
                          time_set_clockdrift, time_end_clockdrift, clockdrift, ...
                          time_begin_trim, time_end_trim, ...
                          pressure_offset);


%% Save the table

%
save(fullfile(repo_dirpath(), 'deploymentInfo_ROXSI2022.mat'), ...
     'deploymentInfo_ROXSI2022')
